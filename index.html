<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBCS Exam Preparation 2026 - Interactive Progress Tracker</title>
    <style>
        /* Print-specific settings */
        @page {
            size: A4;
            margin: 15mm 10mm 15mm 10mm;
        }
        @media print {
            .no-print { display: none !important; }
            body { font-size: 10pt !important; line-height: 1.4 !important; color: #000 !important; }
            h1 { font-size: 18pt !important; }
            h2 { font-size: 14pt !important; }
            h3 { font-size: 12pt !important; }
            table { font-size: 8pt !important; }
            .page-break { page-break-before: always !important; }
        }
        
        /* General styles */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', 'Arial', 'Helvetica', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            transition: background 0.3s, color 0.3s;
        }
        
        body.dark-mode {
            background: #1a1a2e;
            color: #eee;
        }
        
        body.dark-mode .container {
            background: #16213e;
        }
        
        body.dark-mode table {
            background: #0f3460;
            color: #eee;
        }
        
        body.dark-mode th {
            background: #0a2647 !important;
        }
        
        body.dark-mode tr:nth-child(even) {
            background-color: #1a3a5a;
        }
        
        body.dark-mode .summary-box,
        body.dark-mode .tips-box,
        body.dark-mode .stats-card {
            background: #0f3460;
            border-color: #4a90e2;
        }
        
        body.dark-mode input[type="number"],
        body.dark-mode input[type="text"],
        body.dark-mode textarea {
            background: #0a2647;
            color: #eee;
            border-color: #4a90e2;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* Header & Navigation */
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
        }
        
        .app-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .app-header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .controls-bar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        body.dark-mode .controls-bar {
            background: #0a2647;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        /* Dashboard Stats */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            transition: transform 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        body.dark-mode .stats-card h3 {
            color: #aaa;
        }
        
        .stats-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stats-card .subtext {
            font-size: 12px;
            color: #999;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #5568d3;
        }
        
        td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            vertical-align: middle;
        }
        
        body.dark-mode td {
            border-color: #2a4a6a;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e9ecef;
        }
        
        body.dark-mode tr:hover {
            background-color: #1a3a5a;
        }
        
        /* Checkboxes */
        .task-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .completed-row {
            background: #d4edda !important;
            opacity: 0.8;
        }
        
        body.dark-mode .completed-row {
            background: #1a4d2e !important;
        }
        
        .completed-row td {
            text-decoration: line-through;
            color: #888;
        }
        
        /* Test Score Input */
        .score-input {
            width: 80px;
            padding: 5px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .score-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .score-good {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .score-average {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .score-poor {
            background: #f8d7da;
            border-color: #dc3545;
        }
        
        /* Highlight styles */
        .highlight { background-color: #fff3cd !important; font-weight: bold; }
        .exam-day { background-color: #d4edda !important; font-weight: bold; }
        .weekend-test { background-color: #cfe2ff !important; }
        .morning-focus { background-color: #fff4e6 !important; }
        .evening-revision { background-color: #f3e5f5 !important; }
        .current-day { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            font-weight: bold;
        }
        .current-day td {
            color: white !important;
        }
        
        /* Summary boxes */
        .summary-box, .tips-box {
            border: 2px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .summary-box h3, .tips-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .tips-box {
            border-left: 5px solid #667eea;
        }
        
        ul {
            margin: 10px 0;
            padding-left: 25px;
        }
        
        li {
            margin: 8px 0;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .modal-content {
            background: #16213e;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        body.dark-mode .close:hover {
            color: #eee;
        }
        
        /* Notes Section */
        .notes-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }
        
        .notes-area:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Study Timer */
        .timer-widget {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .timer-display {
            font-size: 48px;
            font-weight: bold;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Achievement Badges */
        .badges {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .badge-gold {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            color: #333;
        }
        
        .badge-silver {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
            color: #333;
        }
        
        .badge-bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #e8a87c 100%);
            color: white;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-header h1 { font-size: 24px; }
            .dashboard { grid-template-columns: 1fr; }
            .controls-bar { flex-direction: column; }
            .btn { width: 100%; }
            table { font-size: 12px; }
            th, td { padding: 6px 4px; }
            .timer-display { font-size: 36px; }
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Confetti effect */
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #667eea;
            position: absolute;
            animation: confetti-fall 3s linear;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- App Header -->
        <div class="app-header no-print">
            <h1>üéØ WBCS Exam Preparation 2026 - Interactive Tracker</h1>
            <div class="subtitle">
                Your Complete 60-Day Journey to Success | Track, Monitor, Achieve
            </div>
        </div>
        
        <!-- Control Bar -->
        <div class="controls-bar no-print">
            <button class="btn btn-primary" onclick="showModal('timerModal')">‚è±Ô∏è Study Timer</button>
            <button class="btn btn-success" onclick="showModal('notesModal')">üìù My Notes</button>
            <button class="btn btn-info" onclick="exportData()">üíæ Export JSON</button>
            <button class="btn btn-warning" onclick="importData()">üì• Import Data</button>
            <button class="btn btn-primary" onclick="exportToPDF()">üìÑ Export PDF</button>
            <button class="btn btn-secondary" onclick="toggleDarkMode()">üåô Dark Mode</button>
            <button class="btn btn-warning" onclick="changePasswordBtn()" id="changePasswordBtn">üîë Change Password</button>
            <button class="btn btn-danger" onclick="secureReset()">üîÑ Reset All</button>
            <button class="btn btn-secondary" onclick="lockApp()">üîí Logout</button>
            <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print</button>
            <span id="userEmailDisplay" style="margin-left: auto; color: #667eea; font-weight: bold;"></span>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="dashboard no-print" id="dashboard">
            <div class="stats-card">
                <h3>Overall Progress</h3>
                <div class="value" id="overallProgress">0%</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="overallProgressBar" style="width: 0%">0%</div>
                </div>
                <div class="subtext">Tasks Completed</div>
            </div>
            
            <div class="stats-card">
                <h3>Study Streak</h3>
                <div class="value" id="studyStreak">0</div>
                <div class="subtext">Consecutive Days</div>
            </div>
            
            <div class="stats-card">
                <h3>Total Study Hours</h3>
                <div class="value" id="totalHours">0.0</div>
                <div class="subtext">Out of 240 hours</div>
            </div>
            
            <div class="stats-card">
                <h3>Tests Completed</h3>
                <div class="value" id="testsCompleted">0/16</div>
                <div class="subtext">Average: <span id="avgScore">0%</span></div>
            </div>
            
            <div class="stats-card">
                <h3>Days Remaining</h3>
                <div class="value" id="daysRemaining">60</div>
                <div class="subtext">Until 1 March 2026</div>
            </div>
            
            <div class="stats-card">
                <h3>Current Status</h3>
                <div class="value" style="font-size: 24px;" id="currentStatus">Ready to Start!</div>
                <div class="subtext" id="motivationText">Let's begin your journey!</div>
            </div>
        </div>
        
        <!-- Achievement Badges -->
        <div class="badges no-print" id="achievementBadges">
            <!-- Badges will be added dynamically -->
        </div>
        
        <!-- Tabs -->
        <div class="tabs no-print">
            <button class="tab active" onclick="switchTab('overview')">üìä Overview</button>
            <button class="tab" onclick="switchTab('weekday')">üìÖ Weekday Routine</button>
            <button class="tab" onclick="switchTab('weekend')">üåÖ Weekend Routine</button>
            <button class="tab" onclick="switchTab('january')">üìÜ January 2026</button>
            <button class="tab" onclick="switchTab('february')">üìÜ February 2026</button>
            <button class="tab" onclick="switchTab('march')">üìÜ March 2026</button>
            <button class="tab" onclick="switchTab('tests')">‚úÖ Test Tracker</button>
            <button class="tab" onclick="switchTab('analytics')">üìà Analytics</button>
        </div>
        
        <!-- Tab Contents -->
        <div id="tab-overview" class="tab-content active">
            <div class="summary-box">
                <h3>üìã Study Schedule Overview</h3>
                <table style="border: none;">
                    <tr>
                        <td style="border: none; width: 40%;"><strong>Total Preparation Days:</strong></td>
                        <td style="border: none;">60 days (31 Dec 2025 - 28 Feb 2026)</td>
                    </tr>
                    <tr>
                        <td style="border: none;"><strong>Weekday Study Hours:</strong></td>
                        <td style="border: none;">3.75 hours (Morning: 2.25 hrs + Evening: 1.5 hrs)</td>
                    </tr>
                    <tr>
                        <td style="border: none;"><strong>Weekend Study Hours:</strong></td>
                        <td style="border: none;">8-8.5 hours (Extended sessions + Tests)</td>
                    </tr>
                    <tr>
                        <td style="border: none;"><strong>Total Study Hours:</strong></td>
                        <td style="border: none;">~240 hours</td>
                    </tr>
                    <tr>
                        <td style="border: none;"><strong>Total Tests Planned:</strong></td>
                        <td style="border: none;">16 tests (14 weekly + 2 full mocks)</td>
                    </tr>
                    <tr>
                        <td style="border: none;"><strong>Target Score:</strong></td>
                        <td style="border: none;">70%+ accuracy (140/200 marks)</td>
                    </tr>
                </table>
            </div>
            
            <h2>üìä Subject-wise Coverage Summary</h2>
            <table>
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Total Hours</th>
                        <th>Key Topics</th>
                        <th>Expected Questions</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Polity</strong></td>
                        <td>~36 hours</td>
                        <td>Constitution, FR, DPSP, Executive, Legislature, Judiciary</td>
                        <td>25-30 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="polity"></td>
                    </tr>
                    <tr>
                        <td><strong>Modern History</strong></td>
                        <td>~32 hours</td>
                        <td>1857-1947, National Movement, Freedom Struggle</td>
                        <td>20-25 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="history"></td>
                    </tr>
                    <tr>
                        <td><strong>Geography</strong></td>
                        <td>~30 hours</td>
                        <td>Physical India, Climate, Rivers, Resources, WB specific</td>
                        <td>20-25 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="geography"></td>
                    </tr>
                    <tr>
                        <td><strong>Economy</strong></td>
                        <td>~28 hours</td>
                        <td>Banking, Fiscal Policy, Agriculture, Industry, Planning</td>
                        <td>15-20 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="economy"></td>
                    </tr>
                    <tr>
                        <td><strong>Science</strong></td>
                        <td>~24 hours</td>
                        <td>Physics, Chemistry, Biology fundamentals</td>
                        <td>15-20 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="science"></td>
                    </tr>
                    <tr>
                        <td><strong>Environment</strong></td>
                        <td>~10 hours</td>
                        <td>Ecology, Biodiversity, Climate Change</td>
                        <td>10-15 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="environment"></td>
                    </tr>
                    <tr>
                        <td><strong>Current Affairs</strong></td>
                        <td>~20 hours</td>
                        <td>National, International, WB specific</td>
                        <td>15-20 MCQs</td>
                        <td><input type="checkbox" class="task-checkbox" data-subject="ca"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div id="tab-weekday" class="tab-content">
            <h2>üìÖ WEEKDAY ROUTINE (Monday to Friday)</h2>
            <table>
                <thead>
                    <tr>
                        <th colspan="5" style="text-align: center;">MONDAY TO FRIDAY - DAILY SCHEDULE</th>
                    </tr>
                    <tr>
                        <th width="15%">Time</th>
                        <th width="25%">Activity</th>
                        <th width="40%">Details</th>
                        <th width="15%">Duration</th>
                        <th width="5%">‚úì</th>
                    </tr>
                </thead>
                <tbody id="weekdaySchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-weekend" class="tab-content">
            <h2>üåÖ COMPLETE WEEKEND ROUTINE</h2>
            
            <h3>Saturday Schedule</h3>
            <table>
                <thead>
                    <tr>
                        <th colspan="5" style="text-align: center;">SATURDAY - COMPLETE SCHEDULE</th>
                    </tr>
                    <tr>
                        <th width="15%">Time</th>
                        <th width="25%">Activity</th>
                        <th width="40%">Details</th>
                        <th width="15%">Duration</th>
                        <th width="5%">‚úì</th>
                    </tr>
                </thead>
                <tbody id="saturdaySchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
            
            <h3 style="margin-top: 30px;">Sunday Schedule</h3>
            <table>
                <thead>
                    <tr>
                        <th colspan="5" style="text-align: center;">SUNDAY - COMPLETE SCHEDULE</th>
                    </tr>
                    <tr>
                        <th width="15%">Time</th>
                        <th width="25%">Activity</th>
                        <th width="40%">Details</th>
                        <th width="15%">Duration</th>
                        <th width="5%">‚úì</th>
                    </tr>
                </thead>
                <tbody id="sundaySchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-january" class="tab-content">
            <h2>üìÜ JANUARY 2026 - COMPLETE STUDY BLUEPRINT</h2>
            <table>
                <thead>
                    <tr>
                        <th colspan="9" style="text-align: center;">JANUARY 2026 - DETAILED DAILY PLAN</th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th>Day</th>
                        <th>Morning Theory</th>
                        <th>Evening Practice</th>
                        <th>Test/Activity</th>
                        <th>Key Topics</th>
                        <th>Hrs</th>
                        <th>Notes</th>
                        <th>‚úì</th>
                    </tr>
                </thead>
                <tbody id="januarySchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-february" class="tab-content">
            <h2>üìÜ FEBRUARY 2026 - COMPLETE STUDY BLUEPRINT</h2>
            <table>
                <thead>
                    <tr>
                        <th colspan="9" style="text-align: center;">FEBRUARY 2026 - DETAILED DAILY PLAN</th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th>Day</th>
                        <th>Morning Theory</th>
                        <th>Evening Practice</th>
                        <th>Test/Activity</th>
                        <th>Key Topics</th>
                        <th>Hrs</th>
                        <th>Notes</th>
                        <th>‚úì</th>
                    </tr>
                </thead>
                <tbody id="februarySchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-march" class="tab-content">
            <h2>üìÜ MARCH 2026 - FINAL PHASE & EXAM</h2>
            <table>
                <thead>
                    <tr>
                        <th colspan="9" style="text-align: center;">MARCH 2026 - FINAL REVISION & MOCKS</th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th>Day</th>
                        <th>Morning Theory</th>
                        <th>Evening Practice</th>
                        <th>Test/Activity</th>
                        <th>Key Topics</th>
                        <th>Hrs</th>
                        <th>Notes</th>
                        <th>‚úì</th>
                    </tr>
                </thead>
                <tbody id="marchSchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-tests" class="tab-content">
            <h2>‚úÖ TEST PERFORMANCE TRACKING</h2>
            <table>
                <thead>
                    <tr>
                        <th>Test #</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>MCQs</th>
                        <th>Focus Areas</th>
                        <th>Target</th>
                        <th>Score</th>
                        <th>%</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="testSchedule">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="tab-analytics" class="tab-content">
            <h2>üìà Progress Analytics</h2>
            
            <div class="summary-box">
                <h3>Performance Trends</h3>
                <div id="performanceChart" style="min-height: 300px; display: flex; align-items: flex-end; gap: 5px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <!-- Chart will be drawn here -->
                </div>
            </div>
            
            <div class="summary-box">
                <h3>Subject-wise Performance</h3>
                <table id="subjectAnalytics">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Sessions Completed</th>
                            <th>Hours Logged</th>
                            <th>Completion %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div class="summary-box">
                <h3>Weekly Breakdown</h3>
                <table id="weeklyBreakdown">
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Days Studied</th>
                            <th>Hours Logged</th>
                            <th>Tests Taken</th>
                            <th>Avg Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="summary-box" style="margin-top: 40px; text-align: center;">
            <h3 style="font-size: 24px; color: #667eea;">üéØ FINAL MOTIVATION</h3>
            <p style="font-size: 16px; margin: 15px 0;">
                <strong>You are preparing for 60 days with discipline and dedication.</strong>
            </p>
            <p style="font-size: 14px;">
                <strong>235+ hours of focused study | 3,500+ MCQs practiced | 16 tests planned</strong>
            </p>
            <p style="font-size: 20px; color: #28a745; margin-top: 20px;">
                <strong>YOU ARE READY! TRUST YOUR PREPARATION!<br>
                ALL THE BEST FOR WBCS 2026! üéØ‚ú®</strong>
            </p>
        </div>
    </div>
    
    <!-- Study Timer Modal -->
    <div id="timerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('timerModal')">&times;</span>
            <div class="timer-widget">
                <h2>‚è±Ô∏è Study Timer</h2>
                <div class="timer-display" id="timerDisplay">00:00:00</div>
                <div class="timer-controls">
                    <button class="btn btn-success" onclick="startTimer()">‚ñ∂Ô∏è Start</button>
                    <button class="btn btn-warning" onclick="pauseTimer()">‚è∏Ô∏è Pause</button>
                    <button class="btn btn-danger" onclick="resetTimer()">‚èπÔ∏è Reset</button>
                    <button class="btn btn-info" onclick="saveStudySession()">üíæ Save Session</button>
                </div>
                <div style="margin-top: 20px; font-size: 14px;">
                    <p>Today's Study Time: <strong id="todayStudyTime">0h 0m</strong></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('notesModal')">&times;</span>
            <h2>üìù My Study Notes</h2>
            <textarea class="notes-area" id="userNotes" placeholder="Write your important notes, key points, formulas, dates, or anything you want to remember..."></textarea>
            <button class="btn btn-success" onclick="saveNotes()" style="margin-top: 15px; width: 100%;">üíæ Save Notes</button>
        </div>
    </div>
    
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
          apiKey: "AIzaSyAThe1_F61AYEZtXl6ISwNkd6D0XMSgg3k",
          authDomain: "wbcs-progress-tracker-30fa6.firebaseapp.com",
          projectId: "wbcs-progress-tracker-30fa6",
          storageBucket: "wbcs-progress-tracker-30fa6.firebasestorage.app",
          messagingSenderId: "9259146",
          appId: "1:9259146:web:7f5a5f23f655ea1bf40573"
        };
        
        // Initialize Firebase
        let firebaseApp, auth, db;
        let currentUser = null;
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('‚úÖ Firebase initialized successfully');
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            alert('‚ö†Ô∏è Firebase not configured. Please add your Firebase config to use cloud features.\n\nThe app will work in offline mode with localStorage.');
        }

        // ==================== FIREBASE AUTHENTICATION ====================
        let isAuthenticated = false;
        
        function checkAuthentication() {
            if (!auth) {
                fallbackToLocalAuth();
                return;
            }
            showLoadingScreen();
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    currentUser = user;
                    isAuthenticated = true;
                    hideLoadingScreen();
                    loadUserData();
                    init();
                } else {
                    hideLoadingScreen();
                    showAuthChoice();
                }
            });
        }
        
        function fallbackToLocalAuth() {
            const savedPassword = localStorage.getItem('wbcsAppPassword');
            if (!savedPassword) showFirstTimeSetup();
            else showLoginScreen();
        }
        
        function showLoadingScreen() {
            const loadingHTML = `<div id="loadingScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="text-align: center; color: white;"><div class="loading" style="width: 50px; height: 50px; margin: 0 auto 20px;"></div><h2>Loading WBCS Tracker...</h2><p>Please wait</p></div></div>`;
            document.body.insertAdjacentHTML('beforeend', loadingHTML);
        }
        
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) loadingScreen.remove();
        }
        
        function showAuthChoice() {
            const choiceHTML = `<div id="authChoice" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%;"><h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">üéØ WBCS Progress Tracker</h2><p style="text-align: center; margin-bottom: 30px; color: #666;">Secure your progress with cloud backup</p><button onclick="showSignup()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">üìù Create New Account</button><button onclick="showLogin()" style="width: 100%; padding: 15px; background: #6c757d; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer;">üîì Login to Existing Account</button><p style="margin-top: 20px; font-size: 12px; color: #999; text-align: center;">‚ú® Free cloud backup ‚Ä¢ üîí Secure authentication ‚Ä¢ üìß Password recovery via email</p></div></div>`;
            document.body.insertAdjacentHTML('beforeend', choiceHTML);
        }
        
        function showSignup() {
            const choice = document.getElementById('authChoice');
            if(choice) choice.remove();
            const signupHTML = `<div id="signupScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%;"><h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">üìù Create Account</h2><p style="text-align: center; margin-bottom: 30px; color: #666;">Register with your email for cloud backup & password recovery</p><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Email:</label><input type="email" id="signupEmail" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="your.email@example.com" /></div><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Password:</label><input type="password" id="signupPassword" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="Minimum 6 characters" /></div><div style="margin-bottom: 30px;"><label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Confirm Password:</label><input type="password" id="signupPasswordConfirm" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="Re-enter password" /></div><button onclick="handleSignup()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">üîí Create Account</button><button onclick="backToAuthChoice()" style="width: 100%; padding: 12px; background: transparent; color: #667eea; border: 2px solid #667eea; border-radius: 5px; font-size: 14px; font-weight: bold; cursor: pointer;">‚Üê Back</button></div></div>`;
            document.body.insertAdjacentHTML('beforeend', signupHTML);
            document.getElementById('signupPasswordConfirm').addEventListener('keypress', e => { if (e.key === 'Enter') handleSignup(); });
        }
        
        function showLogin() {
            const choice = document.getElementById('authChoice');
            if(choice) choice.remove();
            const loginHTML = `<div id="loginScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%;"><h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">üîì Login</h2><p style="text-align: center; margin-bottom: 30px; color: #666;">Access your study progress</p><div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Email:</label><input type="email" id="loginEmail" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="your.email@example.com" autofocus /></div><div style="margin-bottom: 30px;"><label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Password:</label><input type="password" id="loginPassword" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;" placeholder="Enter your password" /></div><button onclick="handleLogin()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 15px;">üîì Login</button><button onclick="handleForgotPassword()" style="width: 100%; padding: 12px; background: transparent; color: #667eea; border: none; font-size: 14px; cursor: pointer; margin-bottom: 10px;">üîë Forgot Password?</button><button onclick="backToAuthChoice()" style="width: 100%; padding: 12px; background: transparent; color: #667eea; border: 2px solid #667eea; border-radius: 5px; font-size: 14px; font-weight: bold; cursor: pointer;">‚Üê Back</button></div></div>`;
            document.body.insertAdjacentHTML('beforeend', loginHTML);
            document.getElementById('loginPassword').addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); });
        }
        
        function backToAuthChoice() {
            const screen = document.getElementById('signupScreen') || document.getElementById('loginScreen');
            if (screen) screen.remove();
            showAuthChoice();
        }
        
        function handleSignup() {
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupPasswordConfirm').value;
            if (!email || !password || !confirmPassword) { alert('‚ö†Ô∏è Please fill in all fields'); return; }
            if (!email.includes('@')) { alert('‚ö†Ô∏è Please enter a valid email address'); return; }
            if (password.length < 6) { alert('‚ö†Ô∏è Password must be at least 6 characters long'); return; }
            if (password !== confirmPassword) { alert('‚ö†Ô∏è Passwords do not match!'); return; }
            auth.createUserWithEmailAndPassword(email, password).then(function(userCredential) {
                currentUser = userCredential.user;
                alert('‚úÖ Account created successfully!');
                document.getElementById('signupScreen').remove();
                saveUserData();
            }).catch(function(error) {
                alert('‚ùå ' + error.message);
            });
        }
        
        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) { alert('‚ö†Ô∏è Please enter both email and password'); return; }
            auth.signInWithEmailAndPassword(email, password).then(function(userCredential) {
                currentUser = userCredential.user;
                document.getElementById('loginScreen').remove();
            }).catch(function(error) {
                alert('‚ùå ' + error.message);
            });
        }
        
        function handleForgotPassword() {
            const email = document.getElementById('loginEmail').value.trim();
            if (!email) { alert('‚ö†Ô∏è Please enter your email address first'); return; }
            if (confirm('üìß Send password reset email to: ' + email + '?')) {
                auth.sendPasswordResetEmail(email).then(() => alert('‚úÖ Password reset email sent!')).catch(error => alert('‚ùå ' + error.message));
            }
        }
        
        function saveUserData() {
            if (!currentUser || !db) return;
            db.collection('users').doc(currentUser.uid).set({
                email: currentUser.email,
                lastUpdated: new Date().toISOString(),
                appState: appState
            }, { merge: true }).then(() => console.log('‚úÖ Cloud Synced')).catch(e => console.error('‚ùå Sync Error', e));
        }
        
        function loadUserData() {
            if (!currentUser || !db) return;
            db.collection('users').doc(currentUser.uid).get().then(function(doc) {
                if (doc.exists && doc.data().appState) {
                    appState = { ...appState, ...doc.data().appState };
                    document.getElementById('userNotes').value = appState.notes || '';
                    if (appState.darkMode) document.body.classList.add('dark-mode');
                    init();
                }
            });
        }
        
        function logoutUser() {
            if (confirm('üîí Logout from WBCS Tracker?')) auth.signOut().then(() => location.reload());
        }
        
        function showFirstTimeSetup() {
            const setupHTML = `<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%;"><h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">üîê Welcome to WBCS Tracker</h2><p style="text-align: center; margin-bottom: 30px; color: #666;">Create a secure local password</p><div style="margin-bottom: 20px;"><label>Create Password:</label><input type="password" id="setupPassword" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px;" /></div><div style="margin-bottom: 30px;"><label>Confirm Password:</label><input type="password" id="setupPasswordConfirm" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px;" /></div><button onclick="completeSetup()" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 5px;">üîí Secure My Progress</button></div></div>`;
            document.body.insertAdjacentHTML('beforeend', setupHTML);
        }
        
        function completeSetup() {
            const p = document.getElementById('setupPassword').value;
            if (p !== document.getElementById('setupPasswordConfirm').value) { alert('Mismatch'); return; }
            localStorage.setItem('wbcsAppPassword', btoa(p));
            location.reload();
        }
        
        function showLoginScreen() {
            const loginHTML = `<div id="loginScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 10000;"><div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 450px; width: 90%;"><h2 style="text-align: center;">üîê Unlock Tracker</h2><input type="password" id="loginPassword" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; margin: 20px 0;" autofocus /><button onclick="attemptLogin()" style="width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 5px;">üîì Unlock</button></div></div>`;
            document.body.insertAdjacentHTML('beforeend', loginHTML);
        }
        
        function attemptLogin() {
            const p = document.getElementById('loginPassword').value;
            if (btoa(p) === localStorage.getItem('wbcsAppPassword')) {
                document.getElementById('loginScreen').remove();
                isAuthenticated = true;
                init();
            } else alert('Wrong password');
        }

        // ==================== DATA STRUCTURES ====================
        const weekdayRoutine = [
            { time: "5:00 AM", activity: "Wake Up", details: "Immediately get up, drink water, fresh up", duration: "10 min", type: "morning" },
            { time: "5:10 AM", activity: "Exercise", details: "Quick cardio, stretching, push-ups", duration: "15 min", type: "morning" },
            { time: "5:25 AM", activity: "Meditation", details: "Deep breathing, focus meditation", duration: "20 min", type: "morning" },
            { time: "5:45 AM", activity: "THEORY STUDY SESSION 1", details: "Primary subject - New concepts, deep learning", duration: "60 min", type: "study" },
            { time: "6:45 AM", activity: "Quick Break", details: "Stretch, water, washroom, eye rest", duration: "5 min", type: "break" },
            { time: "6:50 AM", activity: "THEORY STUDY SESSION 2", details: "Continue topic or complementary subject", duration: "60 min", type: "study" },
            { time: "7:50 AM", activity: "Quick Revision", details: "Rapid recall of morning topics", duration: "10 min", type: "study" },
            { time: "8:00 AM", activity: "Get Ready for Office", details: "Bath, breakfast, dress up", duration: "90 min", type: "other" },
            { time: "9:30 AM", activity: "Leave for Office", details: "Commute to workplace", duration: "30 min", type: "other" },
            { time: "10:00 AM", activity: "Office Hours", details: "Professional work", duration: "9 hours", type: "other" },
            { time: "7:00 PM", activity: "Return Home & Refresh", details: "Commute, change, light snack", duration: "60 min", type: "other" },
            { time: "8:00 PM", activity: "Dinner", details: "Light meal with family", duration: "30 min", type: "other" },
            { time: "8:30 PM", activity: "Evening Setup", details: "Room tidy, materials ready", duration: "10 min", type: "evening" },
            { time: "8:40 PM", activity: "MCQ PRACTICE", details: "40-50 MCQs from morning topics", duration: "40 min", type: "study" },
            { time: "9:20 PM", activity: "Error Analysis", details: "Review wrong answers, make notes", duration: "15 min", type: "study" },
            { time: "9:35 PM", activity: "Current Affairs", details: "Daily news, monthly magazine", duration: "20 min", type: "study" },
            { time: "9:55 PM", activity: "Plan Tomorrow", details: "Check schedule, prepare books", duration: "5 min", type: "other" },
            { time: "10:00 PM", activity: "Wind Down", details: "Prepare for sleep, no screens", duration: "30 min", type: "other" },
            { time: "10:30 PM", activity: "Sleep", details: "Mandatory 6.5 hours minimum", duration: "Until 5 AM", type: "other" }
        ];
        
        const saturdayRoutine = [
            { time: "5:00 AM", activity: "Wake Up", details: "Start weekend with energy", duration: "10 min" },
            { time: "5:10 AM", activity: "Exercise", details: "20 min workout (extended)", duration: "20 min" },
            { time: "5:30 AM", activity: "Meditation", details: "Deep focus meditation", duration: "15 min" },
            { time: "5:45 AM", activity: "THEORY MARATHON 1", details: "Deep dive into complex topics", duration: "120 min" },
            { time: "7:45 AM", activity: "Breakfast Break", details: "Nutritious meal", duration: "30 min" },
            { time: "8:15 AM", activity: "THEORY MARATHON 2", details: "Continue subjects", duration: "90 min" },
            { time: "9:45 AM", activity: "Break & Prep", details: "Prepare for test", duration: "15 min" },
            { time: "10:00 AM", activity: "WEEKLY TEST", details: "50-100 MCQs exam conditions", duration: "90 min" },
            { time: "11:30 AM", activity: "Error Analysis", details: "Detailed review", duration: "30 min" },
            { time: "12:00 PM", activity: "Lunch & Rest", details: "Complete break", duration: "60 min" },
            { time: "1:00 PM", activity: "Weekly Chores", details: "Cleaning, organization", duration: "60 min" },
            { time: "2:00 PM", activity: "Revision Session", details: "Week's important topics", duration: "90 min" },
            { time: "3:30 PM", activity: "Current Affairs", details: "Weekly compilation", duration: "30 min" },
            { time: "4:00 PM", activity: "Tea Break", details: "Complete mental break", duration: "30 min" },
            { time: "4:30 PM", activity: "Practice Marathon", details: "120+ MCQs", duration: "120 min" },
            { time: "6:30 PM", activity: "Evening Walk", details: "Outdoor time", duration: "30 min" },
            { time: "7:00 PM", activity: "Dinner & Family", details: "Quality time", duration: "60 min" },
            { time: "8:00 PM", activity: "Light Revision", details: "Notes review", duration: "60 min" },
            { time: "9:00 PM", activity: "Week Planning", details: "Next week schedule", duration: "30 min" },
            { time: "9:30 PM", activity: "Wind Down", details: "Prepare for sleep", duration: "30 min" },
            { time: "10:00 PM", activity: "Sleep", details: "Rest for Sunday", duration: "7 hours" }
        ];
        
        const sundayRoutine = [
            { time: "5:00 AM", activity: "Wake Up", details: "Maintain consistency", duration: "10 min" },
            { time: "5:10 AM", activity: "Light Exercise", details: "Yoga, stretching", duration: "15 min" },
            { time: "5:25 AM", activity: "Meditation", details: "Extended peace session", duration: "20 min" },
            { time: "5:45 AM", activity: "REVISION MARATHON", details: "Complete week's revision", duration: "150 min" },
            { time: "8:15 AM", activity: "Breakfast", details: "Relaxed Sunday meal", duration: "30 min" },
            { time: "8:45 AM", activity: "Test Preparation", details: "Mental preparation", duration: "15 min" },
            { time: "9:00 AM", activity: "SUNDAY TEST", details: "50-100 MCQs comprehensive", duration: "90 min" },
            { time: "10:30 AM", activity: "Detailed Analysis", details: "In-depth error review", duration: "60 min" },
            { time: "11:30 AM", activity: "Lunch & Rest", details: "Extended Sunday break", duration: "90 min" },
            { time: "1:00 PM", activity: "Weak Areas Focus", details: "Problem topics intensive", duration: "120 min" },
            { time: "3:00 PM", activity: "Current Affairs", details: "Weekly magazine", duration: "60 min" },
            { time: "4:00 PM", activity: "Outdoor Time", details: "Walk in park", duration: "60 min" },
            { time: "5:00 PM", activity: "Practice Session", details: "Topic-wise MCQs", duration: "90 min" },
            { time: "6:30 PM", activity: "Dinner & Family", details: "Early Sunday dinner", duration: "60 min" },
            { time: "7:30 PM", activity: "Next Week Planning", details: "Review targets", duration: "60 min" },
            { time: "8:30 PM", activity: "Light Reading", details: "Easy revision", duration: "30 min" },
            { time: "9:00 PM", activity: "Prepare for Monday", details: "Office clothes ready", duration: "30 min" },
            { time: "9:30 PM", activity: "Early Sleep", details: "Rest for Monday", duration: "7.5 hours" }
        ];
        
        const januarySchedule = [
            { date: "1 Jan", day: "Thu", morning: "Polity: Constitution Basics, Preamble", evening: "Previous year Polity MCQs (50)", test: "New Year Holiday", topics: "Features, History", hours: 3.75 },
            { date: "2 Jan", day: "Fri", morning: "History: 1857 Revolt - Causes & Course", evening: "1857 MCQs + Timeline practice", test: "-", topics: "Leaders, Results", hours: 3.75 },
            { date: "3 Jan", day: "Sat", morning: "Geography: Earth, Solar System, Latitudes (3.5 hrs)", evening: "Geography MCQs + Maps (2 hrs)", test: "Extended Saturday", topics: "Longitudes, Time", hours: 8.5 },
            { date: "4 Jan", day: "Sun", morning: "Economy: GDP, GNP, NDP, National Income (2.5 hrs)", evening: "Economy MCQs + Revision", test: "TEST 1: 50 MCQs", topics: "Basic concepts", hours: 8 },
            { date: "5 Jan", day: "Mon", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 26 Jan", hours: 0 },
            { date: "6 Jan", day: "Tue", morning: "History: Social Reform Movements", evening: "Reformers MCQs + Dates", test: "-", topics: "Brahmo, Arya Samaj", hours: 3.75 },
            { date: "7 Jan", day: "Wed", morning: "Geography: Indian Physiography - Himalayas", evening: "Mountain ranges MCQs + Maps", test: "-", topics: "Peaks, Passes", hours: 3.75 },
            { date: "8 Jan", day: "Thu", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 27 Jan", hours: 0 },
            { date: "9 Jan", day: "Fri", morning: "Science: Physics - Motion, Work, Energy", evening: "Physics MCQs + Numericals", test: "-", topics: "Laws of motion", hours: 3.75 },
            { date: "10 Jan", day: "Sat", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 28 Jan", hours: 0 },
            { date: "11 Jan", day: "Sun", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 29 Jan", hours: 0 },
            { date: "12 Jan", day: "Mon", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 30 Jan", hours: 0 },
            { date: "13 Jan", day: "Tue", morning: "History: INC Formation, Moderate Phase", evening: "Early Congress MCQs", test: "-", topics: "1885-1905 leaders", hours: 3.75 },
            { date: "14 Jan", day: "Wed", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 31 Jan", hours: 0 },
            { date: "15 Jan", day: "Thu", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 1 Feb", hours: 0 },
            { date: "16 Jan", day: "Fri", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 2 Feb", hours: 0 },
            { date: "17 Jan", day: "Sat", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 3 Feb", hours: 0 },
            { date: "18 Jan", day: "Sun", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 4 Feb", hours: 0 },
            { date: "19 Jan", day: "Mon", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 5 Feb", hours: 0 },
            { date: "20 Jan", day: "Tue", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 6 Feb", hours: 0 },
            { date: "21 Jan", day: "Wed", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 7 Feb", hours: 0 },
            { date: "22 Jan", day: "Thu", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 8 Feb", hours: 0 },
            { date: "23 Jan", day: "Fri", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 9 Feb", hours: 0 },
            { date: "24 Jan", day: "Sat", morning: "MISSED", evening: "MISSED", test: "-", topics: "Rescheduled to 10 Feb", hours: 0 },
            { date: "25 Jan", day: "Sun", morning: "MISSED (Up to 10 AM)", evening: "MISSED", test: "-", topics: "Rescheduled to 11 Feb", hours: 0 },
            { date: "26 Jan", day: "Mon", morning: "Makeup: Fundamental Rights (Art 12-35)", evening: "FR MCQs + Case laws", test: "-", topics: "Rescheduled from 5 Jan", hours: 3.75 },
            { date: "27 Jan", day: "Tue", morning: "Makeup: Money, Banking, RBI Functions", evening: "Banking MCQs + Current rates", test: "-", topics: "Rescheduled from 8 Jan", hours: 3.75 },
            { date: "28 Jan", day: "Wed", morning: "Makeup: Heat, Light, Sound (Science)", evening: "Science comprehensive MCQs", test: "-", topics: "Rescheduled from 10 Jan", hours: 3.75 },
            { date: "29 Jan", day: "Thu", morning: "Makeup: Current Affairs Dec 2025", evening: "CA MCQs + State specific", test: "-", topics: "Rescheduled from 11 Jan", hours: 3.75 },
            { date: "30 Jan", day: "Fri", morning: "Makeup: DPSP (Art 36-51) & FD", evening: "DPSP comparison MCQs", test: "-", topics: "Rescheduled from 12 Jan", hours: 3.75 },
            { date: "31 Jan", day: "Sat", morning: "Makeup: Indian Drainage - Rivers", evening: "Rivers MCQs + Maps", test: "Makeup Day", topics: "Rescheduled from 14 Jan", hours: 8.5 }
        ];
        
        const februarySchedule = [
            { date: "1 Feb", day: "Sun", morning: "Makeup: Fiscal Policy, Budget", evening: "Budget MCQs", test: "TEST 2: 50 MCQs", topics: "Rescheduled from 15 Jan", hours: 8 },
            { date: "2 Feb", day: "Mon", morning: "Makeup: Chem - Atomic Structure", evening: "Chemistry MCQs", test: "-", topics: "Rescheduled from 16 Jan", hours: 3.75 },
            { date: "3 Feb", day: "Tue", morning: "Makeup: Hist - National Movement Timeline", evening: "Chronology Practice", test: "-", topics: "Rescheduled from 17 Jan", hours: 3.75 },
            { date: "4 Feb", day: "Wed", morning: "Makeup: Polity - Executive (President/PM)", evening: "Executive MCQs", test: "-", topics: "Rescheduled from 18 Jan", hours: 3.75 },
            { date: "5 Feb", day: "Thu", morning: "Makeup: Polity - Parliament", evening: "Legislature MCQs", test: "-", topics: "Rescheduled from 19 Jan", hours: 3.75 },
            { date: "6 Feb", day: "Fri", morning: "Makeup: Hist - Swadeshi Movement", evening: "Extremist phase MCQs", test: "-", topics: "Rescheduled from 20 Jan", hours: 3.75 },
            { date: "7 Feb", day: "Sat", morning: "Makeup: Geo - Climate & Monsoon", evening: "Weather MCQs", test: "TEST 3: 50 MCQs", topics: "Rescheduled from 21 Jan", hours: 8.5 },
            { date: "8 Feb", day: "Sun", morning: "Makeup: Eco - Agriculture & Green Rev", evening: "Agriculture MCQs", test: "TEST 4: 50 MCQs", topics: "Rescheduled from 22 Jan", hours: 8 },
            { date: "9 Feb", day: "Mon", morning: "Makeup: Science - Acids, Bases, Salts", evening: "Chem MCQs", test: "-", topics: "Rescheduled from 23 Jan", hours: 3.75 },
            { date: "10 Feb", day: "Tue", morning: "Makeup: Geo Complete - Physical/Eco", evening: "Map work MCQs", test: "-", topics: "Rescheduled from 24 Jan", hours: 3.75 },
            { date: "11 Feb", day: "Wed", morning: "Makeup: Eco Marathon Revision", evening: "Eco Comp MCQs", test: "-", topics: "Rescheduled from 25 Jan", hours: 3.75 },
            { date: "12 Feb", day: "Thu", morning: "Republic Day makeup: Constitution Special", evening: "Polity 100 MCQs", test: "-", topics: "Rescheduled from 26 Jan", hours: 3.75 },
            { date: "13 Feb", day: "Fri", morning: "History: Home Rule, Lucknow Pact", evening: "1916-1919 MCQs", test: "-", topics: "Rescheduled from 27 Jan", hours: 3.75 },
            { date: "14 Feb", day: "Sat", morning: "Geography: Soils of India, Vegetation", evening: "Soil MCQs + Maps", test: "TEST 5: 50 MCQs", topics: "Rescheduled from 28 Jan", hours: 8.5 },
            { date: "15 Feb", day: "Sun", morning: "Economy: Industry, Make in India", evening: "Industry MCQs", test: "TEST 6: 50 MCQs", topics: "Rescheduled from 29 Jan", hours: 8 },
            { date: "16 Feb", day: "Mon", morning: "Science: Biology - Cell, Tissues", evening: "Bio MCQs", test: "-", topics: "Rescheduled from 30 Jan", hours: 3.75 },
            { date: "17 Feb", day: "Tue", morning: "Polity Complete Revision", evening: "Polity 100 MCQs marathon", test: "-", topics: "Rescheduled from 31 Jan", hours: 3.75 },
            { date: "18 Feb", day: "Wed", morning: "Environment: Ecology, Biodiversity", evening: "Env Comp MCQs", test: "-", topics: "Rescheduled from 1 Feb", hours: 3.75 },
            { date: "19 Feb", day: "Thu", morning: "Polity: Judiciary - SC, High Courts", evening: "Judicial MCQs", test: "-", topics: "Rescheduled from 2 Feb", hours: 3.75 },
            { date: "20 Feb", day: "Fri", morning: "History: Non-Cooperation Movement", evening: "Gandhi era MCQs", test: "-", topics: "Rescheduled from 3 Feb", hours: 3.75 },
            { date: "21 Feb", day: "Sat", morning: "Geography: Minerals & Energy", evening: "Resources MCQs", test: "TEST 7: 75 MCQs", topics: "Rescheduled from 4 Feb", hours: 8.5 },
            { date: "22 Feb", day: "Sun", morning: "Economy: Planning, NITI Aayog", evening: "Planning MCQs", test: "TEST 8: 75 MCQs", topics: "Rescheduled from 5 Feb", hours: 8 },
            { date: "23 Feb", day: "Mon", morning: "Science: Human Body Systems", evening: "Biology MCQs", test: "-", topics: "Rescheduled from 6 Feb", hours: 3.75 },
            { date: "24 Feb", day: "Tue", morning: "History Complete: 1857-1947", evening: "Timeline Drill", test: "-", topics: "Rescheduled from 7 Feb", hours: 3.75 },
            { date: "25 Feb", day: "Wed", morning: "Integrated: Polity + Geography", evening: "Combined topic MCQs", test: "-", topics: "Rescheduled from 8 Feb", hours: 3.75 },
            { date: "26 Feb", day: "Thu", morning: "Polity: Local Government", evening: "Panchayat MCQs", test: "-", topics: "Rescheduled from 9 Feb", hours: 3.75 },
            { date: "27 Feb", day: "Fri", morning: "History: Civil Disobedience", evening: "Salt March MCQs", test: "-", topics: "Rescheduled from 10 Feb", hours: 3.75 },
            { date: "28 Feb", day: "Sat", morning: "Geography WB: Physical & Rivers", evening: "WB specific MCQs", test: "TEST 9: 75 MCQs", topics: "Rescheduled from 11 Feb", hours: 8.5 }
        ];

        const marchSchedule = [
            { date: "1 Mar", day: "Sun", morning: "Economy: Recent Govt Schemes", evening: "Schemes MCQs", test: "TEST 10: 75 MCQs", topics: "Rescheduled from 12 Feb", hours: 8 },
            { date: "2 Mar", day: "Mon", morning: "Science: Environment Issues", evening: "Env MCQs + Treaties", test: "-", topics: "Rescheduled from 13 Feb", hours: 3.75 },
            { date: "3 Mar", day: "Tue", morning: "Mixed Revision: All weak areas", evening: "Problem topics intensive", test: "-", topics: "Rescheduled from 14 Feb", hours: 3.75 },
            { date: "4 Mar", day: "Wed", morning: "Science Complete: Phy/Chem/Bio", evening: "Science comp MCQs", test: "-", topics: "Rescheduled from 15 Feb", hours: 3.75 },
            { date: "5 Mar", day: "Thu", morning: "Polity: Emergency Provisions", evening: "Emergency MCQs", test: "-", topics: "Rescheduled from 16 Feb", hours: 3.75 },
            { date: "6 Mar", day: "Fri", morning: "History: Quit India & INA", evening: "1942-47 MCQs", test: "-", topics: "Rescheduled from 17 Feb", hours: 3.75 },
            { date: "7 Mar", day: "Sat", morning: "Geography WB: Economy/Industry", evening: "WB economy MCQs", test: "TEST 11: 75 MCQs", topics: "Rescheduled from 18 Feb", hours: 8.5 },
            { date: "8 Mar", day: "Sun", morning: "Reasoning: Logic patterns", evening: "Reasoning 50 practice", test: "TEST 12: 100 MCQs", topics: "Rescheduled from 19 Feb", hours: 8 },
            { date: "9 Mar", day: "Mon", morning: "Quant: Perc/Ratio/Shortcuts", evening: "Math MCQs", test: "-", topics: "Rescheduled from 20 Feb", hours: 3.75 },
            { date: "10 Mar", day: "Tue", morning: "Complete GS Revision", evening: "Mock practice", test: "-", topics: "Rescheduled from 21 Feb", hours: 3.75 },
            { date: "11 Mar", day: "Wed", morning: "Current Affairs Jan-Feb 2026", evening: "CA comp MCQs", test: "-", topics: "Rescheduled from 22 Feb", hours: 3.75 },
            { date: "12 Mar", day: "Thu", morning: "English: Vocabulary/Grammar", evening: "English comp MCQs", test: "-", topics: "Rescheduled from 23 Feb", hours: 3.75 },
            { date: "13 Mar", day: "Fri", morning: "Formulas & Quick Facts", evening: "Quick revision MCQs", test: "-", topics: "Rescheduled from 24 Feb", hours: 3.75 },
            { date: "14 Mar", day: "Sat", morning: "Timeline Revision: All Hist", evening: "Chronology final check", test: "TEST 13: 100 MCQs", topics: "Rescheduled from 25 Feb", hours: 8.5 },
            { date: "15 Mar", day: "Sun", morning: "Maps & Visual Diagrams", evening: "Geography visual practice", test: "TEST 14: 100 MCQs", topics: "Rescheduled from 26 Feb", hours: 8 },
            { date: "16 Mar", day: "Mon", morning: "Final Weak Point Analysis", evening: "Most frequent mistakes review", test: "-", topics: "Rescheduled from 27 Feb", hours: 3.75 },
            { date: "17 Mar", day: "Tue", morning: "LIGHT STUDY ONLY", evening: "Mantra: Focus on accuracy", test: "Self-Review", topics: "Mental Preparation", hours: 2 },
            { date: "18 Mar", day: "Wed", morning: "REST / Chill", evening: "Packing Exam Kit", test: "Mock Simulation", topics: "Preparation Done", hours: 0 },
            { date: "19 Mar", day: "Thu", morning: "PRE-EXAM RELAXATION", evening: "Early Bed", test: "FULL MOCK: 200 MCQs", topics: "Exam Conditions", hours: 3 },
            { date: "20 Mar", day: "Fri", morning: "WBCS EXAM 2026", evening: "Success!", test: "FINAL EXAM DAY", topics: "üéØ GOAL ACHIEVED", hours: 0 }
        ];
        
        const testSchedule = [
            { num: 1, date: "4 Jan", type: "Weekly", mcqs: 50, focus: "Polity + History", target: 25 },
            { num: 2, date: "1 Feb", type: "Weekly", mcqs: 50, focus: "Makeup Topics 1", target: 30 },
            { num: 3, date: "7 Feb", type: "Weekly", mcqs: 50, focus: "Makeup Topics 2", target: 30 },
            { num: 4, date: "8 Feb", type: "Weekly", mcqs: 50, focus: "Makeup Topics 3", target: 32 },
            { num: 5, date: "14 Feb", type: "Advanced", mcqs: 75, focus: "Geo/Eco Focus", target: 51 },
            { num: 6, date: "15 Feb", type: "Advanced", mcqs: 75, focus: "Polity Complete", target: 51 },
            { num: 7, date: "21 Feb", type: "Advanced", mcqs: 75, focus: "Science/Hist", target: 53 },
            { num: 8, date: "22 Feb", type: "Advanced", mcqs: 75, focus: "Env/Science", target: 53 },
            { num: 9, date: "28 Feb", type: "Comprehensive", mcqs: 100, focus: "WB Geo/Hist", target: 70 },
            { num: 10, date: "1 Mar", type: "Comprehensive", mcqs: 100, focus: "Schemes/GS", target: 72 },
            { num: 11, date: "7 Mar", type: "Comprehensive", mcqs: 100, focus: "Mixed Full", target: 72 },
            { num: 12, date: "8 Mar", type: "Comprehensive", mcqs: 100, focus: "Math/Reasoning", target: 75 },
            { num: 13, date: "14 Mar", type: "Mock", mcqs: 150, focus: "Final Sprint 1", target: 110 },
            { num: 14, date: "15 Mar", type: "Mock", mcqs: 150, focus: "Final Sprint 2", target: 110 },
            { num: 15, date: "19 Mar", type: "Full Mock", mcqs: 200, focus: "Simulation", target: 145 },
            { num: 16, date: "20 Mar", type: "FINAL EXAM", mcqs: 200, focus: "WBCS 2026", target: 140 }
        ];

        let appState = {
            completedTasks: {},
            testScores: {},
            studyHours: {},
            notes: "",
            timerSeconds: 0,
            timerRunning: false,
            timerInterval: null,
            darkMode: false,
            lastSaveDate: null
        };
        
        function init() {
            if (!isAuthenticated) return;
            loadState();
            renderAllSchedules();
            renderTestSchedule();
            updateDashboard();
            updateAnalytics();
            calculateDaysRemaining();
            attachEventListeners();
            checkAchievements();
            if (currentUser && currentUser.email) {
                const display = document.getElementById('userEmailDisplay');
                if (display) display.textContent = 'üë§ ' + currentUser.email;
            }
        }
        
        function loadState() {
            const saved = localStorage.getItem('wbcsTrackerState');
            if (saved) {
                appState = { ...appState, ...JSON.parse(saved) };
                document.getElementById('userNotes').value = appState.notes || '';
                if (appState.darkMode) document.body.classList.add('dark-mode');
            }
        }
        
        function saveState() {
            appState.lastSaveDate = new Date().toISOString();
            localStorage.setItem('wbcsTrackerState', JSON.stringify(appState));
            if (currentUser && db) saveUserData();
        }
        
        function renderAllSchedules() {
            renderWeekdaySchedule(); renderSaturdaySchedule(); renderSundaySchedule();
            renderJanuarySchedule(); renderFebruarySchedule(); renderMarchSchedule();
        }
        
        function renderMarchSchedule() {
            const tbody = document.getElementById('marchSchedule');
            if(!tbody) return;
            tbody.innerHTML = marchSchedule.map((item, index) => {
                const taskId = `mar-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                const rowClass = isCompleted ? 'completed-row' : (item.day === 'Sat' || item.day === 'Sun' ? 'weekend-test' : '');
                return `<tr class="${rowClass}"><td><strong>${item.date}</strong></td><td>${item.day}</td><td>${item.morning}</td><td>${item.evening}</td><td>${item.test}</td><td>${item.topics}</td><td>${item.hours}</td><td><button class="btn btn-info" style="padding: 4px 8px; font-size: 11px;" onclick="openNoteForDay('${taskId}')">‚úèÔ∏è</button></td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderWeekdaySchedule() {
            const tbody = document.getElementById('weekdaySchedule');
            tbody.innerHTML = weekdayRoutine.map((item, index) => {
                const taskId = `weekday-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                const rowClass = isCompleted ? 'completed-row' : (item.type === 'study' ? 'highlight' : '');
                return `<tr class="${rowClass}"><td><strong>${item.time}</strong></td><td><strong>${item.activity}</strong></td><td>${item.details}</td><td>${item.duration}</td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderSaturdaySchedule() {
            const tbody = document.getElementById('saturdaySchedule');
            tbody.innerHTML = saturdayRoutine.map((item, index) => {
                const taskId = `saturday-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                return `<tr class="${isCompleted ? 'completed-row' : ''}"><td><strong>${item.time}</strong></td><td><strong>${item.activity}</strong></td><td>${item.details}</td><td>${item.duration}</td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderSundaySchedule() {
            const tbody = document.getElementById('sundaySchedule');
            tbody.innerHTML = sundayRoutine.map((item, index) => {
                const taskId = `sunday-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                return `<tr class="${isCompleted ? 'completed-row' : ''}"><td><strong>${item.time}</strong></td><td><strong>${item.activity}</strong></td><td>${item.details}</td><td>${item.duration}</td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderJanuarySchedule() {
            const tbody = document.getElementById('januarySchedule');
            tbody.innerHTML = januarySchedule.map((item, index) => {
                const taskId = `jan-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                const rowClass = isCompleted ? 'completed-row' : (item.day === 'Sat' || item.day === 'Sun' ? 'weekend-test' : '');
                return `<tr class="${rowClass}"><td><strong>${item.date}</strong></td><td>${item.day}</td><td>${item.morning}</td><td>${item.evening}</td><td>${item.test}</td><td>${item.topics}</td><td>${item.hours}</td><td><button class="btn btn-info" style="padding: 4px 8px; font-size: 11px;" onclick="openNoteForDay('${taskId}')">‚úèÔ∏è</button></td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderFebruarySchedule() {
            const tbody = document.getElementById('februarySchedule');
            tbody.innerHTML = februarySchedule.map((item, index) => {
                const taskId = `feb-${index}`;
                const isCompleted = appState.completedTasks[taskId] || false;
                const rowClass = isCompleted ? 'completed-row' : (item.day === 'Sat' || item.day === 'Sun' ? 'weekend-test' : '');
                return `<tr class="${rowClass}"><td><strong>${item.date}</strong></td><td>${item.day}</td><td>${item.morning}</td><td>${item.evening}</td><td>${item.test}</td><td>${item.topics}</td><td>${item.hours}</td><td><button class="btn btn-info" style="padding: 4px 8px; font-size: 11px;" onclick="openNoteForDay('${taskId}')">‚úèÔ∏è</button></td><td><input type="checkbox" class="task-checkbox" data-task="${taskId}" ${isCompleted ? 'checked' : ''}></td></tr>`;
            }).join('');
        }
        
        function renderTestSchedule() {
            const tbody = document.getElementById('testSchedule');
            tbody.innerHTML = testSchedule.map((test) => {
                const testId = `test-${test.num}`;
                const score = appState.testScores[testId] || '';
                const percentage = score ? Math.round((score / test.mcqs) * 100) : 0;
                const targetPerc = Math.round((test.target / test.mcqs) * 100);
                let scClass = score ? (percentage >= targetPerc ? 'score-good' : (percentage >= targetPerc - 10 ? 'score-average' : 'score-poor')) : '';
                return `<tr><td><strong>Test ${test.num}</strong></td><td>${test.date}</td><td>${test.type}</td><td>${test.mcqs}</td><td>${test.focus}</td><td>${test.target}/${test.mcqs} (${targetPerc}%)</td><td><input type="number" class="score-input ${scClass}" min="0" max="${test.mcqs}" data-test="${testId}" data-total="${test.mcqs}" value="${score}" placeholder="0"></td><td>${percentage}%</td><td>${score ? (percentage >= targetPerc ? '‚úÖ Met' : '‚ö†Ô∏è Below') : '‚è≥ Pending'}</td></tr>`;
            }).join('');
        }

        // ==================== DASHBOARD LOGIC ====================
        function updateDashboard() {
            const completed = Object.keys(appState.completedTasks).length;
            const totalTasks = januarySchedule.length + februarySchedule.length + marchSchedule.length + 60; 
            const progressPerc = Math.round((completed / totalTasks) * 100);
            document.getElementById('overallProgress').textContent = progressPerc + '%';
            document.getElementById('overallProgressBar').style.width = progressPerc + '%';
            document.getElementById('overallProgressBar').textContent = progressPerc + '%';
            document.getElementById('studyStreak').textContent = calculateStreak();
            document.getElementById('totalHours').textContent = calculateTotalHours().toFixed(1) + 'h';
            const testsDone = Object.keys(appState.testScores).filter(k => appState.testScores[k] > 0).length;
            document.getElementById('testsCompleted').textContent = `${testsDone}/16`;
            document.getElementById('avgScore').textContent = calculateAverageScore() + '%';
            updateStatus(progressPerc);
        }
        
        function calculateStreak() {
            let streak = 0; const today = new Date();
            for (let i = 0; i < 80; i++) {
                const d = new Date(today); d.setDate(d.getDate() - i);
                const dStr = d.toISOString().split('T')[0];
                const hasTasks = Object.keys(appState.completedTasks).some(k => k.includes(dStr));
                if (hasTasks) streak++; else break;
            }
            return streak;
        }
        
        function calculateTotalHours() {
            let total = 0;
            januarySchedule.forEach((d, i) => { if (appState.completedTasks[`jan-${i}`]) total += d.hours; });
            februarySchedule.forEach((d, i) => { if (appState.completedTasks[`feb-${i}`]) total += d.hours; });
            marchSchedule.forEach((d, i) => { if (appState.completedTasks[`mar-${i}`]) total += d.hours; });
            if (appState.studyHours) Object.values(appState.studyHours).forEach(h => total += h);
            return total;
        }
        
        function calculateAverageScore() {
            const scores = Object.values(appState.testScores).filter(s => s > 0);
            if (!scores.length) return 0;
            let totalP = 0;
            scores.forEach((s, i) => { const t = testSchedule[i]; if(t) totalP += (s / t.mcqs) * 100; });
            return Math.round(totalP / scores.length);
        }
        
        function updateStatus(progress) {
            let s = "Getting Started", m = "Every expert was once a beginner!";
            if (progress >= 75) { s = "Almost There!"; m = "Final sprint - you've got this!"; }
            else if (progress >= 50) { s = "Great Progress!"; m = "Halfway there - keep pushing!"; }
            else if (progress >= 25) { s = "Building Momentum"; m = "Consistency is the key!"; }
            document.getElementById('currentStatus').textContent = s;
            document.getElementById('motivationText').textContent = m;
        }
        
        function calculateDaysRemaining() {
            const exam = new Date('2026-03-20'), today = new Date();
            const diff = Math.ceil((exam - today) / (1000 * 60 * 60 * 24));
            document.getElementById('daysRemaining').textContent = diff > 0 ? diff : 0;
        }

        // ==================== ANALYTICS ====================
        function updateAnalytics() { renderPerformanceChart(); updateSubjectAnalytics(); updateWeeklyBreakdown(); }
        
        function renderPerformanceChart() {
            const container = document.getElementById('performanceChart');
            const scores = testSchedule.slice(0, 16).map(t => {
                const s = appState.testScores[`test-${t.num}`] || 0;
                return s ? Math.round((s / t.mcqs) * 100) : 0;
            });
            container.innerHTML = scores.map((s, i) => {
                const h = (s / 100) * 250;
                const c = s >= 70 ? '#28a745' : s >= 50 ? '#ffc107' : '#dc3545';
                return `<div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;"><div style="width:100%; background:${c}; height:${h}px; border-radius:5px 5px 0 0; position:relative;"><span style="position:absolute; top:-20px; left:50%; transform:translateX(-50%); font-size:11px; font-weight:bold;">${s}%</span></div><div style="margin-top:5px; font-size:10px;">T${i+1}</div></div>`;
            }).join('');
        }
        
        function updateSubjectAnalytics() {
            const tbody = document.querySelector('#subjectAnalytics tbody');
            const data = calculateSubjectWiseProgress();
            tbody.innerHTML = data.map(s => `<tr><td><strong>${s.name}</strong></td><td>${s.completed}/${s.total}</td><td>${s.hours.toFixed(1)}h</td><td><div class="progress-bar-container"><div class="progress-bar" style="width:${s.percentage}%">${s.percentage}%</div></div></td></tr>`).join('');
        }
        
        function calculateSubjectWiseProgress() {
            const subs = { 'Polity':0, 'History':0, 'Geography':0, 'Economy':0, 'Science':0, 'Environment':0, 'Current Affairs':0 };
            const res = Object.keys(subs).map(n => ({ name: n, completed: 0, total: 0, hours: 0 }));
            [...januarySchedule, ...februarySchedule, ...marchSchedule].forEach((day, idx) => {
                let taskId;
                if (idx < januarySchedule.length) taskId = `jan-${idx}`;
                else if (idx < januarySchedule.length + februarySchedule.length) taskId = `feb-${idx - januarySchedule.length}`;
                else taskId = `mar-${idx - januarySchedule.length - februarySchedule.length}`;
                
                const done = appState.completedTasks[taskId];
                res.forEach(s => {
                    if (day.morning.toLowerCase().includes(s.name.toLowerCase())) {
                        s.total++; if (done) { s.completed++; s.hours += day.hours; }
                    }
                });
            });
            res.forEach(s => s.percentage = s.total ? Math.round((s.completed/s.total)*100) : 0);
            return res;
        }
        
        function updateWeeklyBreakdown() {
            const tbody = document.querySelector('#weeklyBreakdown tbody');
            const data = calculateWeeklyProgress();
            tbody.innerHTML = data.map(w => `<tr><td><strong>${w.name}</strong></td><td>${w.daysCompleted}/7</td><td>${w.hours.toFixed(1)}h</td><td>${w.testsCompleted}</td><td>${w.avgScore ? w.avgScore + '%' : '-'}</td></tr>`).join('');
        }

        function calculateWeeklyProgress() {
            const weeks = Array.from({length:12}, (_,i) => ({ name:`Week ${i+1}`, daysCompleted:0, hours:0, testsCompleted:0, totalScore:0, count:0, avgScore:0 }));
            const allDays = [...januarySchedule, ...februarySchedule, ...marchSchedule];
            allDays.forEach((day, i) => {
                let taskId;
                if (i < januarySchedule.length) taskId = `jan-${i}`;
                else if (i < januarySchedule.length + februarySchedule.length) taskId = `feb-${i-januarySchedule.length}`;
                else taskId = `mar-${i-januarySchedule.length-februarySchedule.length}`;
                
                const wIdx = Math.floor(i / 7); 
                if (wIdx < 12 && appState.completedTasks[taskId]) { 
                    weeks[wIdx].daysCompleted++; 
                    weeks[wIdx].hours += day.hours; 
                }
            });
            testSchedule.slice(0,16).forEach((test, i) => {
                const s = appState.testScores[`test-${test.num}`];
                const wIdx = Math.floor(i / 1.5); // spread tests across weeks
                if (wIdx < 12 && s > 0) { 
                    weeks[wIdx].testsCompleted++; 
                    weeks[wIdx].totalScore += (s/test.mcqs)*100; 
                    weeks[wIdx].count++; 
                }
            });
            weeks.forEach(w => w.avgScore = w.count ? Math.round(w.totalScore/w.count) : 0);
            return weeks;
        }

        // ==================== EVENT HANDLERS ====================
        function attachEventListeners() {
            document.addEventListener('change', e => {
                if (e.target.classList.contains('task-checkbox')) {
                    const id = e.target.dataset.task;
                    appState.completedTasks[id] = e.target.checked;
                    const row = e.target.closest('tr');
                    if (e.target.checked) { row.classList.add('completed-row'); showConfetti(); } else row.classList.remove('completed-row');
                    saveState(); updateDashboard(); updateAnalytics(); checkAchievements();
                }
            });
            document.addEventListener('input', e => {
                if (e.target.classList.contains('score-input')) {
                    const id = e.target.dataset.test, tot = parseInt(e.target.dataset.total), val = parseInt(e.target.value) || 0;
                    appState.testScores[id] = val;
                    saveState(); renderTestSchedule(); updateDashboard(); updateAnalytics();
                }
            });
        }
        
        function switchTab(name) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${name}`).classList.add('active');
            event.target.classList.add('active');
        }
        
        function showModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        window.onclick = e => { if (e.target.classList.contains('modal')) e.target.style.display = 'none'; };

        // ==================== TIMER ====================
        function startTimer() { if (!appState.timerRunning) { appState.timerRunning = true; appState.timerInterval = setInterval(() => { appState.timerSeconds++; updateTimerDisplay(); }, 1000); } }
        function pauseTimer() { appState.timerRunning = false; clearInterval(appState.timerInterval); }
        function resetTimer() { pauseTimer(); appState.timerSeconds = 0; updateTimerDisplay(); }
        function updateTimerDisplay() {
            const h = Math.floor(appState.timerSeconds/3600), m = Math.floor((appState.timerSeconds%3600)/60), s = appState.timerSeconds%60;
            document.getElementById('timerDisplay').textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }
        function saveStudySession() {
            const hrs = appState.timerSeconds/3600; const today = new Date().toISOString().split('T')[0];
            if (!appState.studyHours) appState.studyHours = {};
            appState.studyHours[today] = (appState.studyHours[today] || 0) + hrs;
            resetTimer(); saveState(); updateDashboard(); alert('Session Saved');
        }

        function saveNotes() { appState.notes = document.getElementById('userNotes').value; saveState(); alert('Notes Saved'); }
        function openNoteForDay(id) { const n = prompt('Enter note:'); if(n!==null){ if(!appState.dailyNotes) appState.dailyNotes={}; appState.dailyNotes[id]=n; saveState(); } }
        
        function exportData() {
            const blob = new Blob([JSON.stringify(appState, null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'wbcs-data.json'; a.click();
        }
        
        function importData() {
            const input = document.createElement('input'); input.type = 'file'; input.accept = '.json';
            input.onchange = e => {
                const reader = new FileReader();
                reader.onload = ev => { appState = JSON.parse(ev.target.result); saveState(); location.reload(); };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); appState.darkMode = document.body.classList.contains('dark-mode'); saveState(); }
        
        function checkAchievements() {
            const badges = [], done = Object.keys(appState.completedTasks).length, streak = calculateStreak();
            if (done >= 10) badges.push({ text: 'üéØ 10 Days', class: 'badge-bronze' });
            if (done >= 30) badges.push({ text: 'üî• 30 Days', class: 'badge-silver' });
            if (streak >= 7) badges.push({ text: 'üí™ Week Streak', class: 'badge-silver' });
            document.getElementById('achievementBadges').innerHTML = badges.map(b => `<div class="badge ${b.class}">${b.text}</div>`).join('');
        }
        
        function showConfetti() {
            for (let i = 0; i < 20; i++) {
                const c = document.createElement('div'); c.className = 'confetti';
                c.style.left = Math.random() * window.innerWidth + 'px';
                c.style.background = ['#667eea','#764ba2','#28a745'][Math.floor(Math.random()*3)];
                document.body.appendChild(c); setTimeout(() => c.remove(), 2000);
            }
        }

        function changePasswordBtn() {
            const p = prompt('Current password:');
            if (btoa(p) !== localStorage.getItem('wbcsAppPassword')) return alert('Wrong');
            const n = prompt('New password:'); localStorage.setItem('wbcsAppPassword', btoa(n)); alert('Changed');
        }

        function secureReset() {
            if(confirm('Reset all progress?')) { localStorage.removeItem('wbcsTrackerState'); location.reload(); }
        }

        function lockApp() { location.reload(); }

        function exportToPDF() {
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            doc.text("WBCS 2026 Progress Report", 105, 20, {align:'center'});
            doc.text(`Overall Progress: ${document.getElementById('overallProgress').textContent}`, 20, 40);
            doc.text(`Hours Studied: ${document.getElementById('totalHours').textContent}`, 20, 50);
            doc.save("WBCS-Report.pdf");
        }

        window.onload = checkAuthentication;
        setInterval(() => { if(isAuthenticated) saveState(); }, 30000);
    </script>
</body>
</html>
